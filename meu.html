<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Página de Perfil</title>
  <style>
   body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: 
    url('https://completesolar.online/static/my/theme1/images/FigmaDDSSlicePNGea61335fc123f1db42a4edeb6dde33fd.png') no-repeat center center,
    url('https://completesolar.online/static/my/theme1/images/FigmaDDSSlicePNG3fee818c0065121517cc19ff138e7028.png') no-repeat center center;
  background-size: cover, cover;
  background-attachment: fixed, fixed;
  color: white;
}

    .container {
      max-width: 400px;
      margin: 0 auto;
      padding-bottom: 80px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      padding: 16px;
      font-size: 18px;
      background: linear-gradient(90deg, #0f2d46, #123a54);
      align-items: center;
    }

    .language img {
      width: 20px;
    }

    .profile {
      text-align: center;
      margin-top: 20px;
    }

    .profile-image {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #222;
      border: 3px solid #00e0ff;
      object-fit: cover;
    }

    .profile-id {
      margin-top: 10px;
      font-size: 18px;
    }

    .vip-info, .team-info {
      font-size: 16px;
      margin-top: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .vip-info img, .team-info img {
      width: 16px;
      height: 16px;
    }

    .vip-box {
  background: 
    url('https://completesolar.online/static/my/theme1/images/FigmaDDSSlicePNG1fda9a2f7a2aabfd458627b57b314abc.png') no-repeat center center,
    #117a8b;
  background-size: cover;
  margin: 20px 16px;
  padding: 12px;
  border-radius: 10px;
  text-align: center;
  color: white; /* Para garantir legibilidade sobre o fundo */
}


    .vip-title {
      font-weight: bold;
    }

    .vip-subtitle {
      font-size: 14px;
      margin-top: 4px;
    }

    .progress-bar {
      margin-top: 8px;
      height: 6px;
      background: white;
      border-radius: 3px;
      opacity: 0.5;
    }

    .menu {
      margin: 20px 16px;
      background: #122a3d;
      border-radius: 10px;
      overflow: hidden;
    }

    .menu-item {
      padding: 14px 16px;
      border-bottom: 1px solid #1f3b53;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .menu-item:last-child {
      border-bottom: none;
    }

    .back-icon {
      width: 20px;
      height: 20px;
      margin-left: 10px;
    }

    .chat-icon {
      position: fixed;
      bottom: 100px;
      right: 20px;
      background: #00c4ff;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
      z-index: 100;
    }

    .chat-icon img {
      width: 24px;
      height: 24px;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      max-width: 400px;
      display: flex;
      justify-content: space-around;
      background: #0f2d46;
      padding: 12px 0;
    }

    .nav-item {
      text-align: center;
      font-size: 14px;
      color: #ccc;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .nav-item img {
      width: 20px;
      height: 20px;
    }

    .nav-item.active {
      color: #00e0ff;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- TOPO -->
    <header class="top-bar">
      <span>Meu</span>
      <span class="language" onclick="window.location.href=''">
        <img src="https://i.postimg.cc/t4M8nqdR/Figma-DDSSlice-PNG620ee7cbd6cf199d63571ff0dbb82945.png" alt="Língua" />
      </span>
    </header>

    <!-- PERFIL -->
    <div class="profile">
      <img src="https://www.seiko.co.jp/seiko_house_ginza/images/221001_share_footer_logo.svg" alt="Profile" class="profile-image" onclick="window.location.href='editar_perfil.html'"/>
      <div class="profile-id">929250130</div>
      <div class="vip-info" onclick="window.location.href=''">
        <img src="https://completesolar.online/static/my/theme1/images/FigmaDDSSlicePNG440d1cd5c6b28088afaea649ae80291c.png" alt="VIP" />
        VIP 0
      </div>
      <div class="team-info" onclick="window.location.href='equipe.html'">
        <img src="https://i.postimg.cc/bNv60XwZ/Figma-DDSSlice-PNGd6b8ef3c64c3578ce46edea50d53dab5.png" alt="Equipe" />
        Equipa 0
      </div>
    </div>

    <!-- VIP BOX -->
    <div class="vip-box" onclick="window.location.href=''">
      <div class="vip-title">Próximo VI0 : VIP0</div>
      <div class="vip-subtitle">Alugue qualquer máquina e torne-se VIP1</div>
      <div class="progress-bar"></div>
    </div>
    <!-- MENU -->
    <div class="menu">
      <div class="menu-item" onclick="window.location.href='equipe.html'">Minha equipe
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 5L16 12L9 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="menu-item" onclick="window.location.href='endereco.html'">Convidar amigos
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 5L16 12L9 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="menu-item" onclick="window.location.href='alterar_senha.html'">Alterar sua senha
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 5L16 12L9 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="menu-item" onclick="window.location.href='conta_recepcao.html'">A minha conta de recepção
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 5L16 12L9 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="menu-item" onclick="window.location.href='troca.html'">Troca de Voucher
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 5L16 12L9 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="menu-item" onclick="window.location.href='registro.html'">Transação
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 5L16 12L9 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="menu-item" onclick="window.location.href='chat.html'">Conversas com apoio ao cliente
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 5L16 12L9 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="menu-item" onclick="logout()">Saída
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 5L16 12L9 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>

    <!-- BOTÃO DE CHAT -->
    <div class="chat-icon" onclick="window.location.href='chat.html'">
      <img src="https://completesolar.online/static/my/theme1/images/FigmaDDSSlicePNGa8cb890d943f7775bcd948904f265dce.png" alt="Chat" />
    </div>

    <!-- BARRA INFERIOR -->
    <nav class="bottom-nav">
      <div class="nav-item" onclick="window.location.href='home.html'">
        <img src="https://i.postimg.cc/pdP58vP7/home.png" alt="Home" />
        Home
      </div>
      <div class="nav-item" onclick="window.location.href='produto.html'">
        <img src="https://i.postimg.cc/rwkNhv8G/product.png" alt="Produto" />
        Produto
      </div>
      <div class="nav-item" onclick="window.location.href='carteira.html'">
        <img src="https://i.postimg.cc/nVNkmXgP/wallet.png" alt="Carteira" />
        Carteira
      </div>
      <div class="nav-item active">
        <img src="https://i.postimg.cc/tRsk73S6/myactive.png" alt="Meu" />
        Meu
      </div>
    </nav>
  </div>

  <script>
function logout() {
  localStorage.removeItem('userId'); // Remove apenas o userId
  window.location.href = 'index.html';
}
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Obter userData do localStorage
        const userDataString = localStorage.getItem('userData');
        if (!userDataString) {
            alert('Dados do usuário não encontrados. Por favor, faça login novamente.');
            window.location.href = 'index.html';
            return;
        }

        const userData = JSON.parse(userDataString);
        const userPhone = userData.phone;

        if (!userPhone) {
            alert('Número de telefone não encontrado. Por favor, faça login novamente.');
            window.location.href = 'index.html';
            return;
        }

        // Elementos da UI que serão atualizados
        const profileIdElement = document.querySelector('.profile-id');
        const vipInfoElement = document.querySelector('.vip-info');
        const vipBoxElement = document.querySelector('.vip-box');
        const vipTitleElement = vipBoxElement.querySelector('.vip-title');
        const vipSubtitleElement = vipBoxElement.querySelector('.vip-subtitle');

        // Primeiro, buscar o usuário nas APIs de 1 a 20
        async function findUserByPhone(phone) {
            for (let i = 1; i <= 20; i++) {
                try {
                    const response = await fetch(`https://685720dc21f5d3463e54855f.mockapi.io/User/${i}`);
                    if (!response.ok) continue;
                    
                    const users = await response.json();
                    const userArray = Array.isArray(users) ? users : [users];
                    const foundUser = userArray.find(user => user.phone === phone);
                    
                    if (foundUser) {
                        return { user: foundUser, apiIndex: i };
                    }
                } catch (error) {
                    console.error(`Erro ao buscar na API ${i}:`, error);
                }
            }
            return null;
        }

        // Depois, buscar os produtos VIP do usuário
        async function findUserProducts(phone) {
            let allProducts = [];
            
            for (let i = 1; i <= 20; i++) {
                try {
                    const response = await fetch(`https://685730c921f5d3463e54a877.mockapi.io/Pro/${i}`);
                    if (!response.ok) continue;
                    
                    const products = await response.json();
                    const productArray = Array.isArray(products) ? products : [products];
                    
                    // Filtrar produtos que pertencem ao usuário
                    const userProducts = productArray.filter(product => product.telefone === phone);
                    allProducts = [...allProducts, ...userProducts];
                } catch (error) {
                    console.error(`Erro ao buscar produtos na API ${i}:`, error);
                }
            }
            
            return allProducts;
        }

        // Determinar o nível VIP com base no valor
        function getVipLevel(valor) {
            if (!valor) return 'VIP 0';
            
            const numValor = parseFloat(valor);
            
            if (numValor >= 500000) return 'VIP 5';
            if (numValor >= 200000) return 'VIP 3';
            if (numValor >= 100000) return 'VIP 5'; // Note que há VIP5 para 100k e 500k
            if (numValor >= 30000) return 'VIP 2';
            if (numValor >= 10000) return 'VIP 1';
            
            return 'VIP 0';
        }

        // Calcular dias restantes
        function calculateDaysRemaining(expirationDate) {
            if (!expirationDate) return 0;
            
            const expDate = new Date(expirationDate);
            const today = new Date();
            const diffTime = expDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            return diffDays > 0 ? diffDays : 0;
        }

        // Atualizar a interface do usuário
        async function updateUserProfile() {
            // Mostrar o phone enquanto carrega
            profileIdElement.textContent = userPhone;
            vipInfoElement.innerHTML = `
                <img src="https://completesolar.online/static/my/theme1/images/FigmaDDSSlicePNG440d1cd5c6b28088afaea649ae80291c.png" alt="VIP" />
                Carregando VIP...
            `;

            // Buscar usuário e produtos
            const userResult = await findUserByPhone(userPhone);
            const products = await findUserProducts(userPhone);
            
            if (!userResult) {
                vipInfoElement.innerHTML = `
                    <img src="https://completesolar.online/static/my/theme1/images/FigmaDDSSlicePNG440d1cd5c6b28088afaea649ae80291c.png" alt="VIP" />
                    VIP 0 (usuário não encontrado)
                `;
                return;
            }

            const { user } = userResult;
            
            // Determinar o maior nível VIP entre os produtos ativos
            let highestVipLevel = 'VIP 0';
            let nextVip = 'VIP1';
            let activeProducts = [];
            
            if (products.length > 0) {
                // Filtrar produtos ativos (com status "ativo" e data de expiração no futuro)
                activeProducts = products.filter(product => {
                    return product.status === 'ativo' && 
                           calculateDaysRemaining(product.dataExpiracao) > 0;
                });
                
                // Encontrar o produto com maior valor
                if (activeProducts.length > 0) {
                    const highestValueProduct = activeProducts.reduce((prev, current) => {
                        return (parseFloat(prev.valor) > parseFloat(current.valor)) ? prev : current;
                    });
                    
                    highestVipLevel = getVipLevel(highestValueProduct.valor);
                    
                    // Mostrar informações do produto VIP
                    vipTitleElement.textContent = `VIP Ativo: ${highestVipLevel}`;
                    vipSubtitleElement.textContent = `Expira em ${calculateDaysRemaining(highestValueProduct.dataExpiracao)} dias`;
                }
            }
            
            // Atualizar informações do usuário
            vipInfoElement.innerHTML = `
                <img src="https://completesolar.online/static/my/theme1/images/FigmaDDSSlicePNG440d1cd5c6b28088afaea649ae80291c.png" alt="VIP" />
                ${highestVipLevel}
            `;
            
            // Se não houver produtos ativos, mostrar o próximo VIP disponível
            if (activeProducts.length === 0) {
                vipTitleElement.textContent = 'Próximo VIP : VIP1';
                vipSubtitleElement.textContent = 'Alugue qualquer máquina e torne-se VIP1';
            }
            
            // Atualizar equipe se existir no usuário
            const teamInfoElement = document.querySelector('.team-info');
            if (user.teamCount) {
                teamInfoElement.innerHTML = `
                    <img src="https://i.postimg.cc/bNv60XwZ/Figma-DDSSlice-PNGd6b8ef3c64c3578ce46edea50d53dab5.png" alt="Equipe" />
                    Equipe ${user.teamCount || 0}
                `;
            }
            
            // Log dos produtos encontrados (para debug)
            console.log('Produtos encontrados:', products);
            console.log('Produtos ativos:', activeProducts);
        }

        // Iniciar o processo de atualização
        updateUserProfile();
    });

    function logout() {
        localStorage.removeItem('userData');
        window.location.href = 'index.html';
    }
</script>
</body>
</html>